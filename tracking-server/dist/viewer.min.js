!function(){"use strict";const e="//viewer.backend.dosi-in.vn",t="_dosi_info_viewer",n={log:e+"/api/user-behaviors/log",timeUnload:e+"/api/user-behaviors/log/:id/time-unload",scrollPercentage:e+"/api/user-behaviors/log/:id/scroll-percentage",updateUserInfo:e+"/api/user-info/:id/"},i=e=>"undefined"!=typeof Storage&&localStorage.getItem(e)?localStorage.getItem(e):"";const r=async()=>{try{if(v=window.location.href,I=i(t),y!=v){if(y=v,window.performance&&performance.navigation.type==performance.navigation.TYPE_RELOAD&&(A=!1),window.location.href==u)return;let e=u;u=window.location.href;const t=window.navigator.userAgent,i=v;S.width=window.outerWidth,S.height=window.outerHeight;let r=!1;"undefined"!=typeof Storage?localStorage.getItem("uuid")?x=localStorage.getItem("uuid"):(localStorage.setItem("uuid",x),r=!0):r=!0;const a=(()=>{try{const e=(document.getElementById("dosi_viewer").src||"").replace(/^[^\?]+\??/,"").split("=");return e.length>0?e[1].replace(" ",""):""}catch(e){return""}})();let o={websiteCode:a,ip:w,uuid:x,href:i,referrer:e,userAgent:t,isPrivateBrowsing:l,browserResolution:S,screenResolution:P,isClick:A,isNewUser:r,createdAt:(new Date).getTime()};if(""!=I&&(o.dosiInfo=I),""==a)return;{let e=JSON.stringify(o);const t=await fetch(n.log,{method:"post",credentials:"include",headers:{"Content-type":"application/json"},body:e}),i=await t.json();g=i.data.logId}return}return}catch(e){return}},a=async()=>{if(!g)return;let e=TimeMe.getTimeOnCurrentPageInSeconds();if(p=e>h?h:p,(h=e>h?e:h)>p)try{p=h;const e=n.timeUnload.replace(":id",g),t={timeUnload:(new Date).getTime(),timeOnPage:h};$.ajax({type:"PUT",async:!1,url:e,data:t})}catch(e){return}};var o=new Promise(function(e,t){try{if(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"))if(window.safariIncognito);else try{window.openDatabase(null,null,null,null),window.localStorage.setItem("test",1),e(!1)}catch(t){e(!0)}else if(navigator.userAgent.includes("Firefox")){var n=indexedDB.open("test");n.onerror=function(){e(!0)},n.onsuccess=function(){e(!1)}}else if(navigator.userAgent.includes("Edge")||navigator.userAgent.includes("Trident")||navigator.userAgent.includes("msie"))window.indexedDB||!window.PointerEvent&&!window.MSPointerEvent||e(!0),e(!1);else{(function(){var e=navigator.userAgent.match(/Chrom(?:e|ium)\/([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)/);if(null!=e&&5==e.length)return e.map(e=>parseInt(e,10))[1]>=76})()&&e(async function(){if("storage"in navigator&&"estimate"in navigator.storage){const{usage:e,quota:t}=await navigator.storage.estimate();return t<12e7}return!1}());const t=window.RequestFileSystem||window.webkitRequestFileSystem;t?t(window.TEMPORARY,100,function(t){e(!1)},function(t){e(!0)}):e(null)}}catch(t){return}});const s=async()=>{await(c=(e=>{l=!!e}),void o.then(function(e){c(e)}))};var c;let l=!1,u=window.document.referrer,d="",w="",g=null,f=0,m=0,h=0,p=0,y="",v="",x=(()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})})(),A=!0,I="";let S={width:window.outerWidth,height:window.outerHeight},P={width:screen.width,height:screen.height};(async function(e){return Promise.all(e.map(async e=>{if(null===e)return Promise.resolve();await(t=e.filename,n=e.filetype,new Promise(e=>{if("js"==n)(i=document.createElement("script")).setAttribute("type","text/javascript"),i.setAttribute("src",t);else if("css"==n){var i;(i=document.createElement("link")).setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",t)}i.onload=function(){return e()},void 0!==i&&document.getElementsByTagName("head")[0].appendChild(i)}))}));var t,n})([window.$?null:{filename:"https://code.jquery.com/jquery-1.12.4.min.js",filetype:"js"},{filename:"https://static.dosi-in.com/var/viewer_js/timeme.min.js",filetype:"js"}]).then(async()=>{TimeMe.initialize({currentPageName:"my-home-page",idleTimeoutInSeconds:5}),setInterval(async()=>{$(document).ready(function(){$(window).scroll(function(e){let t=$(window).scrollTop()/($(document).height()-$(window).height()),n=Math.round(100*t);m=n>f?f:m,f=n>f?n:f})}),await(async()=>{try{if(g&&f>m){m=f;const e=n.scrollPercentage.replace(":id",g),t={scroll:f};$.ajax({type:"PUT",async:!0,url:e,data:t})}}catch(e){return}})()},3e3),w=await(async()=>{try{const e=await fetch("https://api64.ipify.org/?format=json"),t=await e.json();return t&&t.ip?t.ip:""}catch(e){return""}})(),await s(),d=window.navigator.userAgent,window.onunload=function(e){return e.preventDefault(),a(),!1},window.addEventListener("click",async()=>{I!=i(t)&&(async()=>{try{if(!g)return;let e=n.updateUserInfo.replace(":id",g);if(""!=(I=i(t))){const t={userInfo:I};$.ajax({type:"POST",async:!1,url:e,data:t})}}catch(e){return}})(),A=!1,await r()}),await r(),setInterval(a,4e3)})}();
//# sourceMappingURL=viewer.min.js.map